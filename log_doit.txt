# 주로 했던일 정리 (설정?등)

- - - - - < 라즈베리파이 > - - - - -

1. 라즈베리파이 디스크 굽기
3.3 may 2020 버전

2. 화면 돌리기
cd /boot 에서 config.txt 마지막에 display_rotate=1추가후 리부팅

3. 업데이트
sudo apt-get update와 sudo apt-get upgrade 진행 + sudo rpi-update

4. 버전확인
python3 -V으로 버전 확인 => 3.7.3

5. 깃 설치
sudo apt-get install git

6. 메인 컴퓨터에 putty 설치

7. 라즈베리파이 주소 확인
hostname -I (대문자 i) 로 라즈베리파이 ip주소 확인 (ifconfig도 가능)

8. 라즈베리파이 전원공급 확인 (255 정상, 0부족)
cat /sys/devices/platform/leds/leds/led1/brightness

9. ip 고정?
라즈베리파이 putty 고정 ip => 다음에 안되면 ㄱ

10. 라즈베리파이에 ssh key생성 
home(~) 에서 ssh-keygen 으로 공개,개인키 생성
cd ~/.ssh 로가서 ls로 생성확인
cat id_rsa.pub 해서 내용 전부 복사
git에 공개키 등록

11. git의 ssh주소 복사

12. cd ~에서 github 폴더 생성후 진입

13. git clone git@github.com:Auint/mini_pot.git 해서 연결 성공

14. python3 TESTZONE.py 로 싱행 확인

15. 라즈베리 계정 생성후 커밋과 풀 테스트 완료
git config --global user.email "temp@temp"
git config --global user.name "RPi_su"

16. sudo reboot로 재시작 후 한번더 테스트

17. sudo halt로 종료

18. 오류생겨서 삭제후 재연결
rm -rf mini_pot
(error : ssh could not resolve hostname github.com)

19. 고정 ip화 
sudo nano /etc/dhcpcd.conf
파일중 이 부분 주석 해제
# Example static IP configuration:
interface wlan0
static ip_address="원하는ip"/24
static routers="라우터ip"
static domain_name_servers="라우터ip"

20. 네트워크 재부팅 + 라즈베리 재부팅
sudo /etc/init.d/networking restart

21. 시간대 설정
date
sudo dpkg-reconfigure tzdata
아시아-서울 확인(gui 화면)
date
(업데이트까지 시간좀 걸리는거 같음)
sudo cat /etc/timezone 

++ 시간대 추가?
sudo apt-get install rdate
sudo /usr/bin/rdate -s time.bora.net
sudo nano /etc/rc.local
추가
rdate -s time.bora.net
date


- - - - - < 서버 > - - - - -

1. aws가입 및 인스턴스 시작
서버 = 서울
프리티어 = 아마존 = t2

2. 인바운드 규칙 
ssh 내 ip접속 허용, https, http 위치무관 접근 허용
socket통신을 위해 tcp포트 8282 설정

3. putty key gen에서 인스턴스 시작시 받았던 key로 동일한 이름의 ppk생성

4. 라즈베리파이랑 동일하게 git 설치 진행
sudo yum install git -y
git config --global user.email "temp@temp"
git config --global user.name "AWS_su"

5. 서버 초기 설정 

6. 기존 시간대 지워주고 한국으로 바꿔주고 확인
sudo rm /etc/localtime
sudo ln -s /usr/share/zoneinfo/Asia/Seoul /etc/localtime
date

7. 루트 비밀번호 아직 미설정

8. 호스트 이름 설정
sudo vim /etc/hosts 에 들어가서 마지막 줄에
127.0.0.1	ec2-minipot 추가

sudo vim /etc/sysconfig/network 에 들어가서 마지막줄에
HOSTNAME=ec2-minipot 추가

sudo reboot 으로 리붓해주고 
hostname 다시 확인
sudo hostnamectl set-hostname ec2-minipot 뭔가 안되서 공식홈페이지 코드 또 실행했더니 됨

9. pip다운
sudo yum install python-pip

10. pymysql다운
pip3 install pymysql



- - - - - < 라즈베리 디비 > - - - - -
1. 디비 존재확인
mysql --version 

2. mysql 서버 설치 
sudo apt-get install mysql-server
sudo apt-get install mysql-client

2. 디비 설치 에러발생 log_error참조

3. 마리아디비로 설정
sudo apt-get install mariadb-server
sudo apt-get install mariadb-client

4. pip 업그레이드
pip install --upgrade setuptools

5. 파이썬으로 pymysql 설치
python3 -m pip install PyMySQL

4. 마리아 디비에 접속
sudo mysql -u root

5. 디비 생성
CREATE DATABASE mysql DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci;

6. 확인
show databases;

5. 루트 비번설정
use mydb
use mysql
select user, host, password from user;
update user set password=password('password') where user = 'root';

+ 팁: 마리아디비 사용시 system을 앞에 붙이면 리눅스 명령어 사용가능
system ls

6. 비밀번호 unix_socket형에서 mysql_native_password형으로 바꿔주기
SELECT User, Host, plugin FROM mysql.user;
update user set plugin='mysql_native_password' where user='root';
flush privileges;
sudo mysql -u root -p로 접속
service mysqld start 
UPDATE user SET password='' WHERE user='root';

UPDATE mysql.user SET password='*6CC6A1C22CFFA93B23769CAE343636557E024D12' WHERE user='auint';

7. 테이블 생성
CREATE TABLE mytable(
    time DATETIME NOT NULL,
    plant varchar(20) NULL,
    temperature int NULL,
    humidity int NULL,
    illuminance float NULL,
    PRIMARY KEY (time)
    );

8. 테이블 생성 확인
show tables;

9. 테이블 속성 확인
desc mytable;
SELECT * FROM mytable; 

10. json사용하기 위해서 다운
==> 파이썬에 내장되있었음

11. 파이썬과 마리아 연결
update user set plugin='';

- - - - - < 서버 디비 > - - - - -
1. 마리아디비 설치
sudo yum install MariaDB-server
sudo yum install MariaDB-client 

2. repo부터 설치
curl -sS https://downloads.mariadb.com/MariaDB/mariadb_repo_setup | sudo bash

3. 다르게
sudo nano /etc/yum.repos.d/MariaDB.repo
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/5.5/centos6-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1

4. 1재실행
yum install MariaDB-server MariaDB-client

5. log_error참조 (#9. 부터)

6. 초기설정
service mysql start
/usr/bin/mysql_secure_installation 

7. 인스턴스 시작-중지
/etc/init.d/mysql start
/etc/init.d/mysql stop

8. 서버 디비 삭제하기

9. 사용자 추가
create user auint@localhost identified by '비밀번호';
grant all privileges on *.* to 'auint'@'localhost' identified by '비밀번호';

10. 사용자 삭제
drop user 'auint'@'localhost';